<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Infinite Cats!</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom styles */
        body {
            font-family: 'Inter', sans-serif; /* Use Inter font */
        }
        /* Simple loading spinner */
        .loader {
            border: 4px solid #f3f3f3; /* Light grey */
            border-top: 4px solid #3498db; /* Blue */
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto; /* Center the loader */
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-100 via-purple-100 to-pink-100 min-h-screen">

    <div class="container mx-auto px-4 py-8">
        <h1 class="text-4xl font-bold text-center text-gray-800 mb-8">Infinite Cats! üêæ</h1>

        <div id="cat-container" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6">
            </div>

        <div id="loader" class="loader hidden"></div>
         <div id="error-message" class="text-center text-red-600 font-semibold mt-4 hidden">
            Oops! Could not load more cats. Please try again later.
        </div>
    </div>

    <script>
        const catContainer = document.getElementById('cat-container');
        const loader = document.getElementById('loader');
        const errorMessage = document.getElementById('error-message');
        let isLoading = false; // Flag to prevent multiple simultaneous loads
        let page = 1; // Keep track of loads (optional, API doesn't use pages here)
        const limit = 12; // Number of cats to fetch per request

        // --- Function to fetch cat images ---
        async function fetchCats() {
            if (isLoading) return; // Don't fetch if already loading
            isLoading = true;
            loader.classList.remove('hidden'); // Show loader
            errorMessage.classList.add('hidden'); // Hide previous errors

            try {
                // Fetch random cat images from the API
                const response = await fetch(`https://api.thecatapi.com/v1/images/search?limit=${limit}&page=${page}&order=Rand`);

                if (!response.ok) {
                    // Handle HTTP errors
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const cats = await response.json();

                // --- Append images to the container ---
                cats.forEach(cat => {
                    const imgWrapper = document.createElement('div');
                    imgWrapper.classList.add('bg-white', 'rounded-lg', 'shadow-md', 'overflow-hidden', 'transform', 'hover:scale-105', 'transition-transform', 'duration-300');

                    const img = document.createElement('img');
                    img.src = cat.url;
                    img.alt = 'A cute cat';
                    img.classList.add('w-full', 'h-64', 'object-cover'); // Style the image
                    // Add a placeholder in case the image fails to load
                    img.onerror = function() {
                        this.onerror=null; // prevent infinite loop if placeholder fails
                        this.src='https://placehold.co/600x400/cccccc/ffffff?text=Cat+Not+Found';
                        this.alt='Image loading failed';
                    };


                    imgWrapper.appendChild(img);
                    catContainer.appendChild(imgWrapper);
                });

                page++; // Increment page counter (though not strictly needed for this random API endpoint)

            } catch (error) {
                console.error("Failed to fetch cats:", error);
                errorMessage.classList.remove('hidden'); // Show error message
            } finally {
                isLoading = false; // Reset loading flag
                loader.classList.add('hidden'); // Hide loader
            }
        }

        // --- Infinite Scroll Logic ---
        function handleScroll() {
            // Check if the user is near the bottom of the page
            // window.innerHeight: Height of the viewport
            // window.scrollY: How much the user has scrolled down
            // document.body.offsetHeight: Total height of the page content
            // 100 (pixels): Offset buffer - load slightly before reaching the absolute bottom
            if (window.innerHeight + window.scrollY >= document.body.offsetHeight - 100 && !isLoading) {
                console.log("Reached bottom, loading more cats...");
                fetchCats();
            }
        }

        // --- Event Listeners ---
        window.addEventListener('scroll', handleScroll);

        // --- Initial Load ---
        // Load the first batch of cats when the page loads
        window.onload = fetchCats;

    </script>

</body>
</html>
